CONN SYS/123@LOCALHOST:1521/XEPDB1 AS SYSDBA ;


ALTER SESSION SET CURRENT_SCHEMA = QLDLNB; 
ALTER SESSION SET "_ORACLE_SCRIPT" = TRUE ;
-- TAO VIEW DE XEM THONG TIN CUA CHINH MINH

CREATE OR REPLACE VIEW UV_NVCB_XEMTTCN 
AS 
SELECT * FROM NHANSU 
WHERE 'NV'||MANV = SYS_CONTEXT('USERENV', 'SESSION_USER') ; 


CREATE OR REPLACE TRIGGER TRG_NVCB_SUA_SODT
INSTEAD OF UPDATE 
ON UV_NVCB_XEMTTCN
FOR EACH ROW
BEGIN 
    UPDATE NHANSU SET DT = :NEW.DT WHERE 'NV'||MANV = SYS_CONTEXT('USERENV', 'SESSION_USER') ;
END;
/

CREATE OR REPLACE VIEW UV_NVCB_XEMTT_SV AS 
SELECT * FROM SINHVIEN;

CREATE OR REPLACE VIEW UV_NVCB_XEMTT_DV AS
SELECT * FROM DONVI;

CREATE OR REPLACE VIEW UV_NVCB_XEMTT_HOCPHAN AS 
SELECT * FROM HOCPHAN ;

CREATE OR REPLACE VIEW UV_NVCB_XEMTT_KHMO AS 
SELECT * FROM KHMO;

DROP ROLE NVCB;
CREATE ROLE NVCB;

GRANT SELECT ON UV_NVCB_XEMTTCN TO NVCB;
GRANT SELECT ON UV_NVCB_XEMTT_SV TO NVCB;
GRANT SELECT ON UV_NVCB_XEMTT_DV TO NVCB;
GRANT SELECT ON UV_NVCB_XEMTT_HOCPHAN TO NVCB;
GRANT SELECT ON UV_NVCB_XEMTT_KHMO TO NVCB;

GRANT UPDATE(DT) ON UV_NVCB_XEMTTCN TO NVCB;

exec USP_GAN_ROLE_NV('NVCB','Nhân viên cơ bản');



